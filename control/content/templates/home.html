<div class="padded">
    <div class="pending-alert-banner" ng-if="ContentHome.moderationEnabled && ContentHome.pendingCount > 0" ng-click="ContentHome.filterByStatus('pending')">
        <div class="pending-alert-content">
            <span class="pending-alert-icon">!</span>
            <span class="pending-alert-text">
                <strong>{{ContentHome.pendingCount}}</strong> post{{ContentHome.pendingCount > 1 ? 's' : ''}} pending review
            </span>
            <span class="pending-alert-action">Click to review</span>
        </div>
    </div>

    <div class="item row" ng-if="ContentHome.moderationEnabled">
        <div class="col-xs-12">
            <div class="btn-group margin-bottom-fifteen" role="group">
                <button type="button" class="btn" ng-class="ContentHome.filterStatus === 'pending' ? 'btn-primary' : 'btn-default'" ng-click="ContentHome.filterByStatus('pending')">
                    Pending ({{ContentHome.pendingCount}})
                </button>
                <button type="button" class="btn" ng-class="ContentHome.filterStatus === 'approved' ? 'btn-primary' : 'btn-default'" ng-click="ContentHome.filterByStatus('approved')">
                    Approved ({{ContentHome.approvedCount}})
                </button>
                <button type="button" class="btn" ng-class="ContentHome.filterStatus === 'rejected' ? 'btn-primary' : 'btn-default'" ng-click="ContentHome.filterByStatus('rejected')">
                    Rejected ({{ContentHome.rejectedCount}})
                </button>
                <button type="button" class="btn" ng-class="ContentHome.filterStatus === 'all' ? 'btn-primary' : 'btn-default'" ng-click="ContentHome.filterByStatus('all')">
                    All Posts ({{ContentHome.allCount}})
                </button>
            </div>
        </div>
    </div>

    <div class="empty-state" ng-if="!ContentHome.posts.length && !ContentHome.loading">
        <h4 class="text-center" style="font-size:16px; line-height:22px;">Looks like you do not have any posts yet. To add one, you can do so through the emulator to your right.</h4>
        <br>
    </div>
    <div class="empty-state" ng-if="ContentHome.loading">
        <h4 class="text-center" style="font-size:16px; line-height:22px;">Loading...</h4>
        <br>
    </div>
    <!-- <div class="">
        <h4 class="text-center" style="font-size:16px; line-height:22px;">Main topic subject</h4>
        <textarea class="form-control" ui-tinymce="ContentHome.descriptionWYSIWYGOptions"
        ng-model="ContentHome.descriptionWYSIWYG" placeholder="WYSIWYG" ng-change="ContentHome.setWYSIWYG()"></textarea>
    </div> -->
    <div
        style="overflow-y:auto;" class="infinite-scroll-parent">
        <div class="wrapper social-plugin" infinite-scroll-distance="0"
            data-infinite-container=".infinite-scroll-parent"
            infinite-scroll="ContentHome.startLoadingPosts"
            infinite-scroll-disabled="ContentHome.noMore">
            <div class="social-item" ng-repeat="post in ContentHome.posts">
                <div class="head flex align-items-center">
                    <div class="media-holder margin-right-ten">
                        <img ng-if="post.userDetails.imageUrl" load-image="1x1" data-final-src="{{post.userDetails.imageUrl}}">
                        <img ng-if="!post.userDetails.imageUrl" load-image="1x1" data-final-src="../../../../styles/media/avatar-placeholder.png">
                    </div>
                    <div class="">
                        <p class="ellipsis margin-bottom-zero">
                            {{getUserName(post.userDetails)}}
                        </p>
                        <p class="time-ago caption margin-bottom-zero">{{ContentHome.getDuration(post.createdOn) | convertTimeFormat}}</p>
                        <span ng-if="post.status" class="badge" ng-class="{'badge-warning': post.status === 'pending', 'badge-success': post.status === 'approved', 'badge-danger': post.status === 'rejected'}" style="margin-left: 10px;">
                            {{post.status | uppercase}}
                        </span>
                    </div>
                    <div class="icons left-auto">
                        <a class="social-icon"
                        ng-click="ContentHome.loadMoreComments(post,'viewComment')">
                        <i class="material-icons-outlined icons2Font notActive" aria-hidden="true">chat_bubble_outline</i>
                            <span class="number">{{post.comments.length}}</span>
                        </a>
                        <span class="social-icon margin-left-twenty">
                            <i class="material-icons-outlined likes-count" aria-hidden="true">favorite_border</i>
                            <span class="number">{{post.likes.length}}</span>
                        </span>
                    </div>
                </div>
                <div class="copy padded">
                    <p class="margin-zero" ng-bind-html="ContentHome.util.injectAnchors(post.text)|newLine"></a>
                        <snap ng-if="(post.text.length>150 && !post.seeMore)">...</snap>
                        <span ng-if="(post.text.length>150 && !post.seeMore)" ng-click="ContentHome.seeMore(post)" class="text-info">Read More</span>
                        <p ng-if="(post.text.length>150 && post.seeMore)" ng-click="ContentHome.seeLess(post)" class="text-info">Read Less</p>
                    </p>
                </div>
                <div class="plugin-banner clearfix margin-bottom-fifteen">
                    <div class="hes-gallery post-images" data-wrap="true" data-img-count="{{post.images.length}}" ng-init="initHesGallery()">
                        <img ng-repeat="image in post.images" ng-src="{{image}}" data-alt="Post image" style="max-width: 100%; height: auto;" onerror="console.error('[ImageError] Failed to load:', this.src);">
                    </div>
                    <div ng-if="post.videos && post.videos.length > 0" class="post-videos" style="margin-top: 10px;">
                        <div class="video-moderation-notice" style="background: #fff3cd; border: 1px solid #ffc107; padding: 8px 12px; border-radius: 4px; margin-bottom: 10px; font-size: 13px; color: #856404;">
                            <strong>Video Content:</strong> Please review {{post.videos.length}} video(s) before approving this post.
                        </div>
                        <video ng-repeat="video in post.videos" controls preload="auto" style="max-width: 100%; max-height: 400px; display: block; margin-bottom: 10px; background: #000; border-radius: 4px;">
                            <source ng-src="{{video | trustAsResourceUrl}}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
                
                <div class="social-footer">
                    <div class="status flex" style="flex-wrap: wrap; gap: 10px;">
                        <a class="text-danger padded-sm caption" ng-click="ContentHome.deletePost(post.id)">Delete Post</a>
                        <a class="btn btn-success btn-sm" ng-if="post.status === 'pending'" ng-click="ContentHome.approvePost(post.id)">Approve</a>
                        <a class="btn btn-danger btn-sm" ng-if="post.status === 'pending'" ng-click="ContentHome.rejectPost(post.id)">Reject</a>
                        <a class="left-auto padded-sm caption" ng-show="post.comments.length" ng-click="post.viewComments = !post.viewComments">
                            {{ post.viewComments ? 'Hide Comments' : 'Show Comments'}}
                        </a>
                    </div>
                    <div ng-if="post.moderatedBy && post.moderatedOn" class="padded-sm caption" style="font-size: 12px; color: #666;">
                        Moderated by {{post.moderatedBy}} on {{ContentHome.getDuration(post.moderatedOn) | convertTimeFormat}}
                        <span ng-if="post.moderationReason"> - Reason: {{post.moderationReason}}</span>
                    </div>
                </div>
                <hr class="small margin-zero" ng-if="post.comments.length && post.viewComments">
                <div class="comments-list" ng-if="post.comments.length && post.viewComments">
                    <div class="social-comment padded" ng-repeat="comment in post.comments">

                        <div class="head clearfix margin-bottom-zero flex">
                            <div class="thread-comment">
                                <p class="ellipsis margin-bottom-zero">{{getUserName(comment.userDetails)}}</p>
                                <p class="time-ago caption">{{ContentHome.getDuration(comment.createdOn) | convertTimeFormat}}</p>
                            </div>
                            <div class="icons left-auto">
                                <span class="social-icon">
                                    <i class="material-icons-outlined likes-count" aria-hidden="true">favorite_border</i>
                                    <span class="number">{{comment.likes.length}}</span>
                                </span>
                            </div>
                        </div>

                        <div class="copy margin-bottom-five">
                            <p class="margin-zero" ng-if="!comment.deletedOn" ng-bind-html="ContentHome.util.injectAnchors(comment.comment) | newLine"></p>
                            <p class="margin-zero" ng-if="comment.deletedOn">
                                This message was deleted.
                            </p>
                        </div>
                        <div class="hes-gallery post-images" data-wrap="true" ng-show="comment.imageUrl.length" data-img-count="{{comment.imageUrl.length}}" ng-init="initHesGallery()">
                            <img ng-repeat="imageUrl in comment.imageUrl" ng-src="{{ContentHome.util.resizeImage(imageUrl)}}" data-alt="Post image">
                        </div>
                        <div ng-if="comment.videos && comment.videos.length > 0" class="comment-videos" style="margin-top: 10px;">
                            <div class="video-moderation-notice" style="background: #fff3cd; border: 1px solid #ffc107; padding: 6px 10px; border-radius: 4px; margin-bottom: 8px; font-size: 12px; color: #856404;">
                                <strong>Video in comment</strong> - Review before approving
                            </div>
                            <video ng-repeat="video in comment.videos" controls preload="auto" style="max-width: 100%; max-height: 300px; display: block; margin-bottom: 10px; background: #000; border-radius: 4px;">
                                <source ng-src="{{video | trustAsResourceUrl}}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <div class="social-footer flex">
                            <a class="text-danger padded-sm caption padding-left-zero" ng-click="ContentHome.deleteComment(post, comment)">Delete Comment</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr class="margin-top-twenty margin-bottom-twenty">

    <div class="item">
        <h4>Sponsor Banner Settings</h4>
        <p class="margin-bottom-fifteen">Configure a sponsor banner or logo that appears at the bottom of all screens in your community wall.</p>

        <div class="form-group">
            <label class="checkbox-label">
                <input type="checkbox" ng-model="ContentHome.bannerSettings.enabled" ng-change="ContentHome.saveBannerSettings()">
                <span>Enable Sponsor Banner</span>
            </label>
        </div>

        <div ng-show="ContentHome.bannerSettings.enabled">
            <div class="form-group">
                <label>Sponsor URL</label>
                <input type="text" class="form-control" ng-model="ContentHome.bannerSettings.sponsorUrl" placeholder="https://example.com" ng-change="ContentHome.saveBannerSettings()">
                <p class="help-block">URL to open when the banner is clicked</p>
            </div>

            <div class="form-group">
                <label>Display Mode</label>
                <div class="radio-group">
                    <label class="radio-inline">
                        <input type="radio" ng-model="ContentHome.bannerSettings.displayMode" value="banner" ng-change="ContentHome.saveBannerSettings()">
                        Banner Mode (Full Width)
                    </label>
                    <label class="radio-inline">
                        <input type="radio" ng-model="ContentHome.bannerSettings.displayMode" value="logo" ng-change="ContentHome.saveBannerSettings()">
                        Logo Mode (Centered)
                    </label>
                </div>
            </div>

            <div class="form-group" ng-show="ContentHome.bannerSettings.displayMode === 'banner'">
                <label>Banner Height (pixels)</label>
                <div class="input-group">
                    <input type="range" min="40" max="200" ng-model="ContentHome.bannerSettings.bannerHeight" ng-change="ContentHome.saveBannerSettings()" style="width: 70%; vertical-align: middle;">
                    <input type="number" class="form-control" min="40" max="200" ng-model="ContentHome.bannerSettings.bannerHeight" ng-change="ContentHome.saveBannerSettings()" style="width: 80px; display: inline-block; margin-left: 10px;">
                </div>
                <p class="help-block">Height of the banner in pixels (40-200)</p>
            </div>

            <div class="form-group" ng-show="ContentHome.bannerSettings.displayMode === 'banner'">
                <label>Banner Background Color</label>
                <input type="color" class="form-control" ng-model="ContentHome.bannerSettings.bannerBgColor" ng-change="ContentHome.saveBannerSettings()" style="width: 100px; height: 40px;">
                <p class="help-block">Background color for the banner</p>
            </div>

            <div class="form-group">
                <label>Sponsor Logo</label>
                <div ng-if="!ContentHome.bannerSettings.sponsorLogo">
                    <button class="btn btn-primary" ng-click="ContentHome.uploadBannerImage()">Upload Logo</button>
                </div>
                <div ng-if="ContentHome.bannerSettings.sponsorLogo" class="banner-preview">
                    <img ng-src="{{ContentHome.bannerSettings.sponsorLogo}}" alt="Sponsor Logo" style="max-width: 300px; max-height: 150px; display: block; margin-bottom: 10px; border: 1px solid #ddd; padding: 5px;">
                    <button class="btn btn-danger btn-sm" ng-click="ContentHome.removeBannerImage()">Remove Logo</button>
                </div>
            </div>

            <div class="form-group" ng-if="ContentHome.bannerSettings.sponsorLogo">
                <label>Preview</label>
                <div class="banner-preview-container" style="border: 1px solid #ddd; padding: 20px; background: #f5f5f5;">
                    <p class="help-block">Preview of how the banner will appear in the widget:</p>
                    <div ng-if="ContentHome.bannerSettings.displayMode === 'banner'" style="position: relative; margin: 0 auto; max-width: 400px; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.15);" ng-style="{'height': ContentHome.bannerSettings.bannerHeight + 'px', 'background': ContentHome.bannerSettings.bannerBgColor}">
                        <img ng-src="{{ContentHome.bannerSettings.sponsorLogo}}" alt="Banner Preview" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div ng-if="ContentHome.bannerSettings.displayMode !== 'banner'" style="display: flex; justify-content: center; align-items: center; background: rgba(255, 255, 255, 0.95); padding: 12px; border-top: 1px solid rgba(0, 0, 0, 0.08); box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.08); margin: 0 auto; max-width: 400px;">
                        <img ng-src="{{ContentHome.bannerSettings.sponsorLogo}}" alt="Logo Preview" style="max-width: 200px; max-height: 80px; object-fit: contain;">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
