<!DOCTYPE html>
<html lang="en" ng-app="socialPluginWidget">

<head>
    <meta name="buildfire" content="disableFastClick,disableSelect">
    <!-- Plugin CSS -->

    <!-- build:bundleCSSFiles  -->
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- endbuild -->

    <!-- JS -->
    <script src="../../../scripts/jquery/jquery-1.11.2.min.js"></script>
    <script src="../../../scripts/buildfire.min.js"></script>
    <script src="../../../scripts/buildfire/components/drawer/drawer.js"></script>
    <script src="../../../scripts/buildfire/services/reportAbuse/reportAbuse.js"></script>
    <script src="../../../scripts/angular/angular.min.js"></script>
    <script src="../../../scripts/angular/angular-route.min.js"></script>
    <script src="../../../scripts/angular/ui-bootstrap.min.js"></script>
    <script src="../../../scripts/angular/angular-animate.min.js"></script>
    <script src="../../../scripts/buildfire/components/skeleton/skeleton.js"></script>
    <script src="../../../scripts/buildfire/components/drawer/drawer.js"></script>
    <script src="../../../scripts/buildfire/components/fabSpeedDial/fabSpeedDial.js"></script>

    <link rel="stylesheet" href="../../../styles/components/skeleton.css" />
    <link rel="stylesheet" href="../../../styles/components/fabSpeedDial/fabSpeedDial.css" />

    <!-- build:bundleCFFiles  -->
    <script src="./CommunityFeedAPI/data/analyticKeys.js"></script>
    <script src="./CommunityFeedAPI/data/Errors.js"></script>
    <script src="./CommunityFeedAPI/data/Post.js"></script>
    <script src="./CommunityFeedAPI/data/Follow.js"></script>
    <script src="./CommunityFeedAPI/dataAccess/Follows.js"></script>
    <!-- endbuild -->
    <!-- build:bundleJSFiles  -->
    <script src="assets/js/moment.js"></script>
    <script src="app.js"></script>
    <script src="app.service.js"></script>
    <script src="enums.js"></script>
    <script src="assets/js/filters.js"></script>
    <script src="controllers/widget.wall.controller.js"></script>
    <script src="controllers/widget.thread.controller.js"></script>
    <script src="controllers/widget.members.controller.js"></script>
    <script src="controllers/widget.report.controller.js"></script>
    <script src="controllers/widget.blocked.controller.js"></script>
    <script src="./assets/js/shared/stringsConfig.js"></script>
    <!-- endbuild -->
    <script>
        moment().format();
    </script>
    <!-- Meta -->
    <meta charset="utf-8">

</head>

<body id="test">
    <div class="main_view" ng-controller="WidgetWallCtrl as WidgetWall">
        <div class="slide-right main-thread-section" ng-show="showThread"
            ng-cloak>
            <div class="backgroundColorTheme content">
                <div class="padding-zero" style="height: 100%;">
                    <div class="social-plugin social-wall">
                        <div ng-show="!WidgetWall.SocialItems.isPrivateChat"
                        class="feed-tabs-container backgroundColorTheme">
                            <div class="feed-tabs">
                                <div class="feed-tab"
                                     ng-class="{'active': WidgetWall.activeTab === 'newest'}"
                                     ng-click="WidgetWall.switchTab('newest')">
                                    <span>Newest</span>
                                </div>
                                <div class="feed-tab"
                                     ng-class="{'active': WidgetWall.activeTab === 'popular'}"
                                     ng-click="WidgetWall.switchTab('popular')">
                                    <span>Most Popular</span>
                                </div>
                                <div class="feed-tab"
                                     ng-class="{'active': WidgetWall.activeTab === 'myPosts'}"
                                     ng-click="WidgetWall.switchTab('myPosts')">
                                    <span>My Posts</span>
                                </div>
                            </div>
                        </div>
                        <div ng-class="{'has-comment-box':WidgetWall.SocialItems.userDetails.userId == null || WidgetWall.allowCreateThread, 'has-feed-tabs': !WidgetWall.SocialItems.isPrivateChat}"
                            class="post-section backgroundColorTheme">
                            <div class="post-infinite-scroll" id="top" ng-class="{'no-scroll': !WidgetWall.postsLoaded}">
                                <div>
                                    <div class="head wysiwyg-container" ng-show="WidgetWall.pinnedPost && !WidgetWall.SocialItems.isPrivateChat"
                                        ng-class="{'margin-top-fifty': WidgetWall.loadedPlugin && WidgetWall.allowFollowLeaveGroup ||
                                            (!WidgetWall.allowFollowLeaveGroup && WidgetWall.SocialItems.appSettings.showMembers)}"
                                        id="pinnedPost">
                                    </div>
                                </div>
                                <div ng-show="WidgetWall.SocialItems.items.length<=0 && WidgetWall.loadedPlugin && !WidgetWall.loading">
                                    <div class="empty_state"></div>
                                </div>
                                <div ng-show="!WidgetWall.postsLoaded">
                                    <div class="social-item margin-top-half-rem" ng-class="{'first-post': WidgetWall.loadedPlugin}"></div>
                                    <div class="social-item"></div>
                                    <div class="social-item"></div>
                                    <div class="social-item"></div>
                                    <div class="social-item"></div>
                                    <div class="social-item"></div>
                                </div>
                                <div class="social-item" ng-repeat="post in WidgetWall.SocialItems.items track by post.id" ng-class="{'first-post': $first}">
                                    <div class="head flex flex-space-between">
                                        <div class="social-profile-photo pointer"
                                            ng-click="WidgetWall.SocialItems.userDetails.userId !== post.userId && WidgetWall.openBottomDrawer(post)">
                                            <div class="media-holder ng-cloak">
                                                <img ng-if="post.userId && post.userDetails.imageUrl" load-image="1x1"
                                                    data-final-src="{{post.userDetails.imageUrl}}" crop-width="40"
                                                    crop-height="40" crop-type="crop"
                                                    alt={{WidgetWall.SocialItems.getUserName(post.userDetails)}}>
                                                <img ng-if="!(post.userId && post.userDetails.imageUrl)"
                                                    load-image="1x1"
                                                    data-final-src="../../../styles/media/avatar-placeholder.png"
                                                    data-img-type="local" crop-width="40" crop-height="40"
                                                    crop-type="default"
                                                    alt="Anonymous">
                                            </div>
                                            <div class="padding-half-rem padding-top-zero padding-bottom-zero">
                                                <div class="social-copy">
                                                    <p ng-if="WidgetWall.SocialItems.userDetails.userId != post.userId" class="text-primary ellipsis">
                                                        <a class="ng-cloak">{{WidgetWall.SocialItems.getUserName(post.userDetails)}}</a>
                                                    </p>

                                                    <p ng-if="WidgetWall.SocialItems.userDetails.userId == post.userId" class="text-primary ellipsis">
                                                        <a class="ng-cloak">{{WidgetWall.SocialItems.getUserName(post.userDetails)}}</a>
                                                    </p>

                                                    <div ng-if="post.createdOn">
                                                        <p class="time-ago opacity-seventy ng-cloak">
                                                            {{WidgetWall.getDuration(post.createdOn) | convertTimeFormat}}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="post-text copy">
                                        <p class="cursor-pointer margin-zero">
                                            <span
                                                class="body-text-theme"
                                                ng-click=" (!WidgetWall.SocialItems.isPrivateChat) ? WidgetWall.goInToThread(post.id) : return"
                                                ng-bind-html="(WidgetWall.util.injectAnchors(post.text) | truncateAndFormat : (post.limit || 150) :0)"></span>
                                            <span ng-if="(post.text.trim().length>150 && !post.seeMore)"
                                                class="ng-cloak">...</span>
                                            <span ng-if="(post.text.trim().length>150 && !post.seeMore)"
                                                ng-click="WidgetWall.seeMore(post)" class="text-info ng-cloak">Read
                                                More</span>
                                                <p ng-if="(post.text.trim().length>150 && post.seeMore)" class="text-info" ng-click="WidgetWall.seeLess(post)">Read Less</p>
                                        </p>
                                    </div>
                                    <div class="post-media-container" ng-if="(post.images && post.images.length > 0) || (post.videos && post.videos.length > 0)">
                                        <div class="post-media-wrapper text-center" style="max-height: none !important;">
                                            <div data-wrap="true">
                                                <div ng-repeat="image in post.images track by $index" class="post-images-container" ng-if="WidgetWall.isValidImageUrl(image)">
                                                    <img ng-src="{{WidgetWall.util.resizeImage(image)}}" data-alt="Post image" ng-click="WidgetWall.SocialItems.previewImage($event, $index, post.images)" onerror="console.error('[ImageError] Failed to load:', this.src); this.style.display='none';">
                                                </div>
                                                <div ng-repeat="video in post.videos track by $index" class="post-videos-container" ng-if="video && video !== ''">
                                                    <video controls width="100%" playsinline ng-src="{{video | trustAsResourceUrl}}">
                                                    </video>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div ng-show="post.userId" class="footer clearfix">
                                        <div class="status">
                                            <div class="status-footer">
                                                <div class="footer-left">
                                                    <a class="social-icon likes ng-cloak"
                                                    ng-click="WidgetWall.likeThread(post)">
                                                    <i class="material-icons-outlined" aria-hidden="true">{{!isItemLiked(post, WidgetWall.SocialItems.userDetails.userId)?"favorite_border":"favorite"}}</i>
                                                    <span class="iconsTheme iconsFont"
                                                    ng-class="{notActive: !isItemLiked(post, WidgetWall.SocialItems.userDetails.userId)}">{{post.likes.length}}</span>
                                                </a>

                                                <a ng-if="!WidgetWall.SocialItems.isPrivateChat"
                                                    ng-click=" (!WidgetWall.SocialItems.isPrivateChat) ? WidgetWall.goInToThread(post.id) : return"
                                                    class="social-icon comments ng-cloak">
                                                    <svg class="comment-bubble-icon" viewBox="0 0 100 100" aria-hidden="true">
                                                        <path d="M50,10 C25,10 5,27 5,48 C5,58 9,67 16,74 L10,90 L28,82 C35,85 42,87 50,87 C75,87 95,70 95,48 C95,27 75,10 50,10 Z" fill="white" stroke="currentColor" stroke-width="3"/>
                                                    </svg>
                                                    <span class="iconsTheme iconsFont">{{post.comments.length}}</span>
                                                </a>
                                                </div>
                                                <div class="footer-right">
                                                    <a class="social-icon ng-cloak" ng-click="WidgetWall.sharePost(post)">
                                                        <img src="assets/img/SHARE.svg" class="share-icon-img" alt="Share">
                                                    </a>
                                                    <a class="social-icon ng-cloak" ng-click="WidgetWall.openBottomDrawer(post)">
                                                        <span class="material-icons-outlined">more_vert</span>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="loadMorePosts" ng-show="WidgetWall.SocialItems.showMorePosts && WidgetWall.SocialItems.items.length > 0" ng-click="WidgetWall.loadMorePosts()">
                                    <button><a>Show More</a></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div
                class="holder padding-zero bottom-post" ng-class="full-post-section">
                <div class="small-post-box" ng-submit="" handle-phone-submit>
                    <div class="post-holder">
                        <div id="addBtn"></div>
                    </div>
                </div>
            </div>

            <div class="bottom-logo-container" ng-if="WidgetWall.bottomLogo && WidgetWall.bottomLogo.enabled && WidgetWall.bottomLogo.imageUrl" ng-click="WidgetWall.handleLogoClick()">
                <div ng-class="{'bottom-banner-mode': WidgetWall.bottomLogo.displayMode === 'banner', 'bottom-logo-mode': WidgetWall.bottomLogo.displayMode !== 'banner'}">
                    <img ng-src="{{WidgetWall.bottomLogo.imageUrl}}" alt="Banner" onerror="console.error('[BannerError] Failed to load banner:', this.src);">
                </div>
            </div>
        </div>

        <div class="slide-left side-thread-section" ng-view="" ng-hide="showThread">
            <h5 class="titleBarTheme text-center" style="margin-top: 35px;">Something went wrong!! Please try again</h5>
        </div>

        <div class="fullscreen-compose" ng-show="WidgetWall.showFullScreenCompose">
            <div class="fullscreen-compose-header" ng-if="WidgetWall.bottomLogo && WidgetWall.bottomLogo.enabled && WidgetWall.bottomLogo.imageUrl" ng-click="WidgetWall.handleLogoClick()">
                <img ng-src="{{WidgetWall.bottomLogo.imageUrl}}" alt="Banner">
            </div>

            <div class="fullscreen-compose-close" ng-click="WidgetWall.closeCustomPostDialog()">
                <span class="material-icons">close</span>
            </div>

            <div class="fullscreen-compose-preview">
                <div class="compose-loading" ng-show="WidgetWall.isUploadingMedia">
                    <div class="loading-spinner"></div>
                    <p>Uploading media...</p>
                </div>

                <div class="compose-media-preview" ng-hide="WidgetWall.isUploadingMedia">
                    <div ng-repeat="image in WidgetWall.selectedImages track by $index" class="preview-image-container">
                        <img ng-src="{{image}}" alt="Selected image">
                    </div>
                    <div ng-repeat="video in WidgetWall.selectedVideos track by $index" class="preview-video-container">
                        <video controls playsinline ng-src="{{video | trustAsResourceUrl}}">
                        </video>
                    </div>
                </div>
            </div>

            <div class="fullscreen-compose-bottom">
                <div class="compose-input-row">
                    <input type="text"
                           class="compose-input"
                           placeholder="Add message"
                           ng-model="WidgetWall.customPostText"
                           ng-keypress="WidgetWall.handlePostKeyPress($event)">
                </div>
                <div class="compose-actions-row">
                    <div class="compose-change-media" ng-click="WidgetWall.openMediaPickerFirst()">
                        <span class="material-icons">photo_camera</span>
                        <span class="change-label">Change selected</span>
                    </div>
                    <div class="compose-send-btn" ng-click="WidgetWall.submitCustomPost()">
                        <img src="assets/img/arrow-bottom-right copy.png" class="send-icon-img" alt="Send">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Gallery Modal -->
    <div id="imageGalleryModal" class="image-gallery-modal" ng-show="WidgetWall.imageGallery.show" ng-click="WidgetWall.closeImageGallery($event)">
        <div class="gallery-close" ng-click="WidgetWall.closeImageGallery($event)">
            <span class="material-icons">close</span>
        </div>

        <div class="gallery-download" ng-click="WidgetWall.downloadImage($event)">
            <span class="material-icons">download</span>
        </div>

        <div class="gallery-counter">
            {{WidgetWall.imageGallery.currentIndex + 1}} / {{WidgetWall.imageGallery.images.length}}
        </div>

        <div class="gallery-content" ng-click="$event.stopPropagation()">
            <div class="gallery-prev" ng-show="WidgetWall.imageGallery.images.length > 1" ng-click="WidgetWall.prevImage($event)">
                <span class="material-icons">chevron_left</span>
            </div>

            <div class="gallery-image-container">
                <img ng-src="{{WidgetWall.imageGallery.images[WidgetWall.imageGallery.currentIndex]}}"
                     alt="Gallery image"
                     class="gallery-image">
            </div>

            <div class="gallery-next" ng-show="WidgetWall.imageGallery.images.length > 1" ng-click="WidgetWall.nextImage($event)">
                <span class="material-icons">chevron_right</span>
            </div>
        </div>

        <div class="gallery-thumbnails" ng-show="WidgetWall.imageGallery.images.length > 1">
            <div ng-repeat="img in WidgetWall.imageGallery.images track by $index"
                 class="gallery-thumbnail"
                 ng-class="{'active': $index === WidgetWall.imageGallery.currentIndex}"
                 ng-click="WidgetWall.goToImage($event, $index)">
                <img ng-src="{{WidgetWall.util.resizeImage(img)}}" alt="Thumbnail {{$index + 1}}">
            </div>
        </div>
    </div>

    <script>
        buildfire.appearance.titlebar.show();
    </script>
    <script src="../../../scripts/buildfire/components/web-components/buildfire-components.js"></script>
    <script src="../../../scripts/buildfire/services/notifications/pushNotifications.js"></script>
    <script src="../../../scripts/buildfire/components/toast/toast.js"></script>
</body>

</html>
